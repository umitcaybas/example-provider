language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://ucaybas.pactflow.io
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "UTL4/VVg97hl1QvgCnXEBgFhDAmgkab+NVOpSD/+LzucRlrbJ9+cBEhl8n6jUryFcq/vdibxFFd8iHofz0uovxQnl6NuwUEY32HkkVusLBUWIrf8wmrX18RMcBsAKTn6pE7+C3PdZKiSC0uFIwpm09CmLa5mSnKbsTyxQkeahAKUPZFzf5ipr3pd0BV3Ghuu+BRw0jHPLsApb6PYBB3047EXDb4VEwrFLVjWQDQFhHTPZvcub0n0HN8nfsYA0mJ9K4nwmPrq97vwXNjoABKwwYz8TDMxIPz96/4kymfdbK3tj/ZkbTNeik6USFJapb9rzyIWArr4l9sOU0Pr+ZJFdGVRkZxZP8qqMggvyBkakM3fpPqIsSFEV2JUYM+M9zrNyZHAQn7g2t71SS+VBjYsGOkX1ZsK+HP6j7oaojwbx9sVmqUNbIQMKs0cCxF26Q5r4wX5F477VwSCxss1/MTRwBGSJ0JTdUVBFmAlHi4+4fKHbcYGLJSGLJwmWQM2c7hS3ygdl801fD99SqUGy069Zy32SAC1nULyMIVj1S/NFgtuEhUWQB6tndp6BJnfPDUnJ3337y7fS1gTRycgZmMHZGs5B7tbA7hBggBC5LMxjwIAHHaK9Mmc1gXqnASS0Ww8xQ5rG+1c97LMjFk0ZOcaGXXpDM+6w69bMOtG39M0OQs="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
